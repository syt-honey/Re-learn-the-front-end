<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Proxy</title>
    <link rel="stylesheet" href="./index.css">
</head>

<body>
<div class="wrapper">
    <div class="color-picker" name="palette">
        <div class="color-indicator" name="palette"></div>
    </div>
<!--     hover to paste-->
    <div class="preview"></div>
    <div class="hue-slider palette" name="hue">
        <div class="slider-indicator" name="hue"></div>
    </div>
    <div class="alpha-slider palette" name="alpha">
        <div class="slider-indicator" name="alpha"></div>
    </div>
    <div class="result">rgba(255, 255, 255, 1)</div>
<!--    TODO 动态模版-->
<!--<div id="template">Hello,{{name}}</div>-->
</div>
<!--<script src="./proxy.js"></script>-->
</body>
<script type="module">
    import { DragContext } from './drag.js';
    import { StyleRender } from './render.js';

    const doms = {};
    const dragContexts = [];

    kickPicker();
    kickSliders();
    StyleRender.getInstance(doms, dragContexts);

    function kickPicker () {
        // 获取色盘有关节点并缓存
        const picker = document.querySelector('.color-picker');
        const indicator = document.querySelector('.color-indicator');
        doms.picker = picker;
        doms.indicator = indicator;

        const name = picker.getAttribute('name');
        const context = new DragContext({
            context: picker,
            dragger: indicator,
            name,
            direction: 'both'
        })

        dragContexts.push(context);
    }

    function kickSliders () {
        const palettes = Array.prototype.slice.call(document.querySelectorAll('.palette'));
        const sliders = Array.prototype.slice.call(document.querySelectorAll('.slider-indicator'));
        doms.palettes = palettes;
        doms.sliders = sliders;

        const contexts = palettes.map((context) => {
            const name = context.getAttribute('name');
            const dragger = sliders.filter(ele => ele.getAttribute('name') === name)[0];

            return new DragContext({
                context,
                dragger,
                name,
                direction: 'horizontal',
                initX: 120
            });
        });

        dragContexts.push(...contexts);
    }
</script>
</html>
